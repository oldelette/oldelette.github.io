<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        DHCP - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{display:block;background:#fff;padding:.5em;color:#333;overflow-x:auto}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.markdown-body{font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e7e7e7;border:0}.markdown-body blockquote{font-size:16px;padding:0 1em;color:#777;border-left:.25em solid #ddd}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid #ccc;border-bottom-color:#bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{padding:0;list-style-type:none}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:transparent}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #ddd}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#333}.markdown-body span.align-center{display:block;overflow:hidden;clear:both}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{display:block;overflow:hidden;clear:both}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{letter-spacing:-.2em;content:"\00a0"}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code,.markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{font-weight:700;background:#f8f8f8;border-top:0}.news .alert .markdown-body blockquote{padding:0 0 0 40px;border:0 none}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle;cursor:default!important}.markdown-body{padding-top:40px;padding-bottom:40px;max-width:758px;overflow:visible!important;position:relative}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{text-align:right;position:relative;display:inline-block;cursor:default;z-index:4;padding:0 8px 0 0;min-width:20px;box-sizing:content-box;color:#afafaf!important;border-right:3px solid #6ce26c!important}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-left:none;border-top:none;border-bottom:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-spacing:0;border-collapse:inherit!important}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{overflow:unset;margin-bottom:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p:last-child{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{text-align:center;background-color:inherit;border-radius:0;white-space:inherit;overflow:visible}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{max-width:100%;height:100%}.markdown-body pre>code.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.markdown-body .alert>p:last-child,.markdown-body .alert>ul:last-child{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{cursor:pointer;display:table;text-align:center;background-position:50%;background-repeat:no-repeat;background-size:contain;background-color:#000;overflow:hidden}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{width:100%;object-fit:contain;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{width:100%;height:100%;position:absolute;top:0;left:0}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{position:absolute;height:auto;width:auto;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;opacity:.3;transition:opacity .2s;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%}.figma{display:table;position:relative;width:100%;padding-bottom:56.25%}.figma iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;border:1px solid #eee}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{position:relative;z-index:2;max-width:760px;margin:25px auto -25px;color:#777}.toc .invisable-node{list-style-type:none}.ui-toc{position:fixed;bottom:20px;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{height:40px;padding:10px 4px;border-top-left-radius:0;border-bottom-left-radius:0}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{opacity:1;color:#fff;transition:opacity .2s}.ui-toc-label:focus{opacity:.3;background-color:#ccc;color:#000}.ui-toc-label:hover{opacity:1;background-color:#ccc;transition:opacity .2s}.ui-toc-dropdown{margin-top:20px;margin-bottom:20px;padding-left:10px;padding-right:10px;max-width:45vw;width:25vw;max-height:70vh;overflow:auto;text-align:inherit}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{padding-right:0;letter-spacing:.0029em}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{display:block;padding:4px 20px;font-size:13px;font-weight:500;color:#767676}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{padding-left:19px;color:#000;text-decoration:none;background-color:transparent;border-left:1px solid #000}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{padding-right:19px;border-left:none;border-right:1px solid #000}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{padding-left:18px;font-weight:700;color:#000;background-color:transparent;border-left:2px solid #000}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{padding-right:18px;border-left:none;border-right:2px solid #000}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:40px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{padding-left:28px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{padding-left:38px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ\ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ\ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{position:fixed;top:0;max-width:15vw;max-height:70vh;overflow:auto}.back-to-top,.expand-toggle,.go-to-bottom{display:block;padding:4px 10px;margin-top:10px;margin-left:10px;font-size:12px;font-weight:500;color:#999}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{width:20px;height:20px;display:block;border-radius:50%;margin-top:2px;margin-bottom:2px;margin-right:5px;background-position:50%;background-repeat:no-repeat;background-size:cover}.ui-user-icon.small{width:18px;height:18px;display:inline-block;vertical-align:middle;margin:0 0 .2em}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;text-decoration:none;padding-left:22px}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{position:relative;z-index:1;color:#222}.markdown-body.slides:before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background-color:currentColor;box-shadow:0 0 0 50vw}.markdown-body.slides section[data-markdown]{position:relative;margin-bottom:1.5em;background-color:#fff;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{position:absolute;top:50%;left:1em;right:1em;transform:translateY(-50%);max-height:100%;overflow:hidden}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{content:"";position:absolute;top:-1.5em;right:1em;height:1.5em;border:3px solid #777}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;text-shadow:0 0 1em transparent,1px 1px 1.2px rgba(0,0,0,.004);-webkit-overflow-scrolling:touch;letter-spacing:.025em;font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-enabled" data-hard-breaks="true"><h6 id="tags-Work" data-id="tags-Work"><a class="anchor hidden-xs" href="#tags-Work" title="tags-Work"><span class="octicon octicon-link"></span></a><span>tags: </span><code>Work</code></h6><h1 id="DHCP" data-id="DHCP"><a class="anchor hidden-xs" href="#DHCP" title="DHCP"><span class="octicon octicon-link"></span></a><span>DHCP</span></h1><p><span>Dynamic Host Configuration Protocol</span></p><p><a href="https://datatracker.ietf.org/doc/html/rfc2131" target="_blank" rel="noopener"><span>RFC 2131</span></a><span>- The Dynamic Host Configuration Protocol (DHCP) provides a framework for passing configuration information to hosts on a TCP/IP network.</span></p><ul>
<li><span>主要功能是讓主機在可以傳送廣播Packet 的網路架構上，運用自己的 MAC Address 藉由網路的廣播位址，向DHCP Server 取得有關IP Address、Network、Mask、Default Gateway、DNS等設定訊息。</span></li>
<li><span>DHCP Server 與 Client 要在相同的Broadcast domain</span></li>
</ul><h2 id="Basic-Phases" data-id="Basic-Phases"><a class="anchor hidden-xs" href="#Basic-Phases" title="Basic-Phases"><span class="octicon octicon-link"></span></a><span>Basic Phases</span></h2><p><a href="https://www.netmanias.com/en/post/techdocs/5998/dhcp-network-protocol/understanding-the-basic-operations-of-dhcp" target="_blank" rel="noopener"><span>必看: IP Address Allocation/Lease Procedure</span></a><br>
<a href="https://www.cyut.edu.tw/~hcchu/course/MAN_95A/MANCh08.pdf" target="_blank" rel="noopener"><span>DHCP phases ppt</span></a></p><p><span>As shown in Figure below, the following </span><strong><span>four basic phases</span></strong><span> are required in DHCP operations between a DHCP server and DHCP client (e.g. a PC) in order for the client to get/lease network configuration data, such as IP address from the DHCP server.</span></p><p><img src="https://i.imgur.com/5rqlQIs.png" alt="" loading="lazy"></p><h3 id="DHCP-Discover" data-id="DHCP-Discover"><a class="anchor hidden-xs" href="#DHCP-Discover" title="DHCP-Discover"><span class="octicon octicon-link"></span></a><span>DHCP Discover</span></h3><p><ins><strong><span>要求租用 IP 位址</span></strong><span> (DHCP Client 端會傳送 DHCPDISCOVER 封包)</span></ins></p><p><span>當我們將電腦設定成 DHCP 用戶端後, 第一次啟動電腦時即會進入此階段。</span><br>
<span>首先由 DHCP 用戶端廣播一個 DHCP Discover (尋找) 封包, 要求任一部 DHCP 伺服器提供 IP 租約。</span></p><details>
<p><span>When a client (PC) is booted, it broadcasts a DHCP Discover message over the Ethernet network to locate all available DHCP servers on the same subnet network (by setting the destination MAC address in the Ethernet header as Broadcast MAC=FF:FF:FF:FF:FF:FF), reaching all the DHCP servers on the same subnet network.</span></p>
</details><h3 id="DHCP-Offer" data-id="DHCP-Offer"><a class="anchor hidden-xs" href="#DHCP-Offer" title="DHCP-Offer"><span class="octicon octicon-link"></span></a><span>DHCP Offer</span></h3><p><ins><strong><span>提供可租用的 IP 位址</span></strong><span> (DHCP Server 端會透過傳送 DHCPOFFER 封包來回應)</span></ins></p><p><span>因為 DHCP Discover 是以廣播方式送出, 所以網路上所有的 DHCP 伺服器都會收到此封包, 而每一台</span><br>
<span>DHCP 伺服器收到此封包時, 都會從本身的領域中, 找出一個可用的 IP 位址, 設定租約期限後記錄在 DHCP Offer (提議) 封包, 再以廣播方式送給用戶端。</span></p><details>
<p><span>When a DHCP server receives the DHCP Discover message from the client, it also broadcasts a DHCP Offer message over the Ethernet network (because the client IP address has not been allocated yet), informing the client that it is available.</span><br>
<span>This message contains the network information, such as client IP address, subnet mask, default gateway IP address, DNS IP address, IP lease time and DHCP server IP address.</span><br>
<span>The DHCP Offer message broadcasted is delivered to all the clients on the same subnet network, including the one that sent the DHCP Discover message.</span></p>
</details><h3 id="DHCP-Request" data-id="DHCP-Request"><a class="anchor hidden-xs" href="#DHCP-Request" title="DHCP-Request"><span class="octicon octicon-link"></span></a><span>DHCP Request</span></h3><p><ins><strong><span>確認 IP 租約</span></strong><span> (DHCP Client 端會藉由傳送 DHCPREQUEST 來回應 DHCPOFFER)</span></ins></p><p><span>因為每一台 DHCP 伺服器都會送出 DHCP Offer 封包，因此 DHCP 用戶端會收到多個DHCP Offer 封包，用戶端預設會接受最先收到的 DHCP Offer 封包，其他陸續收到的DHCP Offer 封包則不予理會。</span></p><p><span>用戶端接著以廣播方式送出 DHCP Request (要求) 封包，除了向選定的伺服器申請租用IP 位址之外, 也讓其他曾送出 DHCP Offer 封包、但未中選的伺服器知道落選了，可以租用給其它的用戶端。</span></p><details>
<p><span>The client, having received the DHCP Offer message, recognizes there is a DHCP server available on the same subnet. Then it broadcasts a DHCP Request message to the server over the Ethernet network, requesting network configuration data including an IP address for itself. If more than one DHCP server responds on the same subnet and hence the client receives multiple DHCP Offer messages, it selects one of the DHCP servers, and enters the IP address of the selected DHCP server in the DHCP Server Identifier (option 54) field of the DHCP Request message. Then it informs all the DHCP servers on the subnet network about such selection by broadcasting the DHCP Request message. Typically, all DHCP servers internally store the network configuration data (i.e. IP address for the client and other information) when they send a DHCP Offer message. So, the client broadcasts the DHCP Request message to all the DHCP servers, so that those not selected can also receive the message and delete the stored network configuration data from their memory.</span></p>
</details><h3 id="DHCP-Ack" data-id="DHCP-Ack"><a class="anchor hidden-xs" href="#DHCP-Ack" title="DHCP-Ack"><span class="octicon octicon-link"></span></a><span>DHCP Ack</span></h3><p><ins><strong><span>同意 IP 租約</span></strong></ins></p><p><span>當被選中的 DHCP 伺服器收到 DHCP Request 封包時，假如同意用戶端的租用要求，便會廣播 DHCP Ack(承認) 封包給 DHCP 用戶端， 告知可以將設定值寫入TCP/IP 中， 並開始計算租用的時間。</span></p><p><span>倘若DHCP 伺服器不能給予 DHCP 用戶端所要求的資訊 (例如：要求租用的 IP 已被佔用， 或者不能給予用戶端所要求的租約期限等)， 則會發出 DHCP Nack (拒絕承認) 封包。</span><br>
<span>當用戶端收到 DHCP Nack 封包時，便直接回到第一階段， 重新執行整個流程。</span></p><details>
<p><span>The DHCP server which received the DHCP Request message from the client checks if the IP address shown in the DHCP Server Identifier (option 54) field matches its own. If it does, it broadcasts a DHCP Ack message ensuring the client can receive the message (Note: the client has NOT been allocated an IP address yet).</span></p>
</details><h3 id="Example" data-id="Example"><a class="anchor hidden-xs" href="#Example" title="Example"><span class="octicon octicon-link"></span></a><span>Example</span></h3><p><img src="https://i.imgur.com/UIlf8W8.png" alt="" loading="lazy"></p><h2 id="Install-DHCP-server" data-id="Install-DHCP-server"><a class="anchor hidden-xs" href="#Install-DHCP-server" title="Install-DHCP-server"><span class="octicon octicon-link"></span></a><span>Install DHCP server</span></h2><p><a href="https://www.youtube.com/watch?v=Q7v4pzQReuo&amp;ab_channel=ErrorAndFix" target="_blank" rel="noopener"><span>看這個影片 Setup DHCP Server in Ubuntu Server 20.04</span></a></p><ul>
<li><span>DHCP Server 架構圖</span><br>
<img src="https://i.imgur.com/r3QMIjn.png" alt="" loading="lazy"></li>
</ul><p><span>自己實驗架構:</span></p><table>
<thead>
<tr>
<th></th>
<th><span>DHCP Server</span></th>
<th><span>DHCP Client</span></th>
</tr>
</thead>
<tbody>
<tr>
<td><span>IP</span></td>
<td><span>172.168.1.200</span></td>
<td><span>172.168.1.80</span></td>
</tr>
<tr>
<td><span>MAC</span></td>
<td><span>08:00:27:6a:c9:27</span></td>
<td><span>08:00:27:2d:d0:93</span></td>
</tr>
</tbody>
</table><ul>
<li><span>設定 NAT Network， 網卡設定如下</span><br>
<img src="https://i.imgur.com/aFnsNjX.png" alt="" loading="lazy"></li>
</ul><h3 id="Step-1" data-id="Step-1"><a class="anchor hidden-xs" href="#Step-1" title="Step-1"><span class="octicon octicon-link"></span></a><span>Step 1</span></h3><pre><code>sudo vim /etc/netplan/00-installer-config.yaml
sudo netplan generate
sudo netplan apply
</code></pre><ul>
<li><span>To use a static IP address 172.168.1.200, I will change the file so that it looks like this afterward:</span></li>
</ul><pre><code> network:
   ethernets:
     enp0s3:
       dhcp4:no
         addresses: [172.168.1.200/24]
         gateway4:  172.168.1.1
         nameservers:
           addresses: [8.8.8.8,8.8.4.4]
</code></pre><h3 id="Step-2" data-id="Step-2"><a class="anchor hidden-xs" href="#Step-2" title="Step-2"><span class="octicon octicon-link"></span></a><span>Step 2</span></h3><pre><code>sudo vim /etc/hosts
</code></pre><p><img src="https://i.imgur.com/A85hh1q.png" alt="" loading="lazy"></p><ul>
<li><span>Now, we will change the hostname of our machine as follows:</span></li>
</ul><pre><code>sudo echo svrdhcp  /etc/hostname 
sudo hostname svrdhcp
</code></pre><h3 id="Step-3" data-id="Step-3"><a class="anchor hidden-xs" href="#Step-3" title="Step-3"><span class="octicon octicon-link"></span></a><span>Step 3</span></h3><p><span>Istall a DHCP server:</span></p><pre><code>sudo apt-get install isc-dhcp-server
sudo vim /et/default/isc-dhcp-server
sudo vim /etc/dhcp/dhcpd.conf
</code></pre><p><span>Add the following lines at the end of the file (replace the IP address to match your network):</span></p><pre><code>subnet 172.168.1.0 netmask 255.255.255.0 {
    range 172.168.1.80 172.168.1.90;
    option routers 172.168.1.1;
    option domain-name-servers 8.8.8.8, 8.8.4.4;
    option domain-name "abc.local";
  }
</code></pre><p><span>Change the default and max lease time if necessary:</span></p><pre><code>default-lease-time 600; #預設租約為 10 分鐘 (單位是 sec)
max-lease-time 7200; #最大租約為 2 小時
</code></pre><p><span>完成</span><br>
<span>systemctl restart isc-dhcp-server 後即可分配 DHCP IP.</span></p><h3 id="列出分配的dhcp地址的命令" data-id="列出分配的dhcp地址的命令"><a class="anchor hidden-xs" href="#列出分配的dhcp地址的命令" title="列出分配的dhcp地址的命令"><span class="octicon octicon-link"></span></a><span>列出分配的dhcp地址的命令</span></h3><ul>
<li><span>dhcp-lease-list</span></li>
</ul><pre><code>dhcp-lease-list [options]
</code></pre><p><img src="https://i.imgur.com/MKIvvB1.png" alt="" loading="lazy"></p><ul>
<li>
<p><span>lease time 租賃時間</span><br>
<span>DHCP server用來決定一個 IP address在使用多久之後，就將這個IP回收，轉發給其它的 Client。</span></p>
</li>
<li>
<p><a href="https://pypi.org/project/dhcp-leases/" target="_blank" rel="noopener"><span>dhcp-leases</span></a><span> python library</span><br>
<span>/var/lib/dhcp/dhcpd.leases</span></p>
</li>
</ul><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">from</span> dhcp_leases <span class="hljs-keyword">import</span> DhcpLeases

leases = DhcpLeases(<span class="hljs-string">'/var/lib/dhcp/dhcpd.leases'</span>)
leases.get()  <span class="hljs-comment"># Returns the leases as a list of Lease objects</span>
dic = leases.get_current()  <span class="hljs-comment"># Returns only the currently valid dhcp leases as dict</span>
                      <span class="hljs-comment"># The key of the dict is the device mac address and the</span>
                      <span class="hljs-comment"># Value is a Lease object</span>
<span class="hljs-built_in">print</span>(dic)
</div></div></code></pre><h3 id="Option-6667" data-id="Option-6667"><a class="anchor hidden-xs" href="#Option-6667" title="Option-6667"><span class="octicon octicon-link"></span></a><span>Option 66/67</span></h3><p><a href="https://askubuntu.com/questions/874648/setting-options-66-and-67-for-isc-dhcp-server" target="_blank" rel="noopener"><span>Setting Options 66 and 67 for ISC DHCP Server</span></a></p><pre><code>sudo vim /etc/dhcp/dhcpd.conf
</code></pre><p><span>and to add the following entries for activating the option 66 and 67.</span></p><pre><code>#option 66
option tftp-server-name "dhcp.server";

#option 67
option bootfile-name "test.cfg";
</code></pre><h2 id="KEA" data-id="KEA"><a class="anchor hidden-xs" href="#KEA" title="KEA"><span class="octicon octicon-link"></span></a><span>KEA</span></h2><p><a href="https://ftp.stu.edu.tw/Unix/isc/kea/1.7.0/doc/kea-arm.pdf" target="_blank" rel="noopener"><span>Kea Administrator Reference Manual</span><br>
</a></p><p><span>&lt;6.4&gt;</span><br>
<span>The following commands are supported by keactrl:</span><br>
<span>• start - starts selected servers.</span><br>
<span>• stop - stops all running servers.</span><br>
<span>• reload - triggers reconfiguration of the selected servers by sending the SIGHUP signal to them.</span><br>
<span>• status - returns the status of the servers (active or inactive) and the names of the configuration files in use.</span><br>
<span>• version - prints out the version of the keactrl tool itself, together with the versions of the Kea daemons.</span></p><h2 id="Other" data-id="Other"><a class="anchor hidden-xs" href="#Other" title="Other"><span class="octicon octicon-link"></span></a><span>Other</span></h2><h3 id="journalctl" data-id="journalctl"><a class="anchor hidden-xs" href="#journalctl" title="journalctl"><span class="octicon octicon-link"></span></a><span>journalctl</span></h3><p><span>Systemd Jounral有提供一個管理工具 </span><a href="https://qastack.cn/unix/225401/how-to-see-full-log-from-systemctl-status-service" target="_blank" rel="noopener"><span>journalctl</span></a><span>，我們可以藉由journalctl對Log進行搜尋。</span></p><p><span>journalctl 可用於檢索 systemd 日誌(由 systemd-journald.service 記錄)</span></p><pre><code>journalctl -u &lt;service-name.service&gt;
</code></pre><p><span>ex: journalctl -u isc-dhcp-server</span></p><h1 id="FTP" data-id="FTP"><a class="anchor hidden-xs" href="#FTP" title="FTP"><span class="octicon octicon-link"></span></a><span>FTP</span></h1><p><span>Could find three different TFTP servers:</span></p><ol>
<li><span>tftpd</span></li>
<li><span>atftpd</span></li>
<li><span>tftpd-hpa</span></li>
</ol><hr><p><span>[2021.12.19]</span><br>
<span>FTP parse log ref:</span></p><ol>
<li><a href="https://gist.github.com/leandrosilva/3651640" target="_blank" rel="noopener"><span>https://gist.github.com/leandrosilva/3651640</span></a></li>
<li><a href="https://github.com/dogoncouch/logdissect" target="_blank" rel="noopener"><span>https://github.com/dogoncouch/logdissect</span></a></li>
</ol><p><span>DHCP:</span><br>
<a href="https://awesomeopensource.com/projects/dhcp/python?categoryPage=11" target="_blank" rel="noopener"><span>The Top 33 Python Dhcp Open Source Projects on Github</span><br>
</a></p><p><img src="https://i.imgur.com/jD1aVrW.png" alt="" loading="lazy"></p><hr><h2 id="AFTP" data-id="AFTP"><a class="anchor hidden-xs" href="#AFTP" title="AFTP"><span class="octicon octicon-link"></span></a><span>AFTP</span></h2><p><a href="https://www.ubuntugeek.com/howto-setup-advanced-tftp-server-in-ubuntu.html" target="_blank" rel="noopener"><span>Howto Setup advanced TFTP server in Ubuntu</span></a></p><pre><code>sudo apt install atftp atftpd
sudo vim /etc/default/atftpd
</code></pre><h3 id="Setting" data-id="Setting"><a class="anchor hidden-xs" href="#Setting" title="Setting"><span class="octicon octicon-link"></span></a><span>Setting</span></h3><p><a href="http://myhomelab.blogspot.com/2014/10/installing-tftp-server-atftpd-in-linux.html" target="_blank" rel="noopener"><span>參考設定: </span></a></p><pre><code>USE_INETD=false
# OPTIONS below are used only with init script
OPTIONS="--tftpd-timeout 300 --retry-timeout 5 --mcast-port 1758 --mcast-addr 239.239.239.0-255 --mcast-ttl 1 --maxthread 100 --verbose=7 /srv/tftp --logfile /var/log/atftpd.log"
</code></pre><p><span>Make changes to run as a server directly, not through inetd ( default)</span></p><pre><code>USE_INETD=false
</code></pre><p><span>Touch /var/log/atftpd.log and set permissions accordingly</span></p><pre><code>sudo touch /var/log/atftpd.log
sudo chmod 644 /var/log/atftpd.log
</code></pre><p><span>Increase logging level by setting to --verbose=7 to capture all messages</span></p><hr><h3 id="Message" data-id="Message"><a class="anchor hidden-xs" href="#Message" title="Message"><span class="octicon octicon-link"></span></a><span>Message</span></h3><p><span>Success sent file  aa.txt</span></p><pre><code>Dec 19 17:02:02 svrdhcp atftpd[6487.140369684129536]: socket may listen on any address, including broadcast
Dec 19 17:02:02 svrdhcp atftpd[6487.140369684129536]: Creating new socket: 172.168.1.200:60501
Dec 19 17:02:02 svrdhcp atftpd[6487.140369684129536]: Serving aa.txt to 172.168.1.81:35377
Dec 19 17:02:02 svrdhcp atftpd[6487.140369684129536]: will do netascii convertion
Dec 19 17:02:02 svrdhcp atftpd[6487.140369684129536]: End of transfer
Dec 19 17:02:02 svrdhcp atftpd[6487.140369684129536]: Server thread exiting
</code></pre><p><span>Failed sent file   bb.txt</span></p><pre><code>Dec 19 17:04:42 svrdhcp atftpd[6487.140369684129536]: socket may listen on any address, including broadcast
Dec 19 17:04:42 svrdhcp atftpd[6487.140369684129536]: Creating new socket: 172.168.1.200:44312
Dec 19 17:04:42 svrdhcp atftpd[6487.140369684129536]: Serving bb.txt to 172.168.1.81:58349
Dec 19 17:04:42 svrdhcp atftpd[6487.140369684129536]: will do netascii convertion
Dec 19 17:04:42 svrdhcp atftpd[6487.140369684129536]: File /srv/tftp/bb.txt not found
Dec 19 17:04:42 svrdhcp atftpd[6487.140369684129536]: Server thread exiting
</code></pre><p><span>Interrupt sent</span></p><pre><code>Dec 19 17:13:14 svrdhcp atftpd[6487.140369684129536]: socket may listen on any address, including broadcast
Dec 19 17:13:14 svrdhcp atftpd[6487.140369684129536]: Creating new socket: 172.168.1.200:40362
Dec 19 17:13:14 svrdhcp atftpd[6487.140369684129536]: Serving aa.deb to 172.168.1.81:36221
Dec 19 17:13:14 svrdhcp atftpd[6487.140369684129536]: will do netascii convertion
Dec 19 17:13:21 svrdhcp atftpd[6487.140369684129536]: timeout: retrying...
Dec 19 17:13:26 svrdhcp atftpd[6487.140369684129536]: timeout: retrying...
Dec 19 17:13:31 svrdhcp atftpd[6487.140369684129536]: timeout: retrying...
Dec 19 17:13:36 svrdhcp atftpd[6487.140369684129536]: timeout: retrying...
Dec 19 17:13:41 svrdhcp atftpd[6487.140369684129536]: timeout: retrying...
Dec 19 17:13:46 svrdhcp atftpd[6487.140369684129536]: client (172.168.1.81) not responding
Dec 19 17:13:46 svrdhcp atftpd[6487.140369684129536]: End of transfer
Dec 19 17:13:46 svrdhcp atftpd[6487.140369684129536]: Server thread exiting
</code></pre><h2 id="TFTP" data-id="TFTP"><a class="anchor hidden-xs" href="#TFTP" title="TFTP"><span class="octicon octicon-link"></span></a><span>TFTP</span></h2><p><span>Trivial File Transfer Protocol 簡單檔案傳輸協定</span></p><p><a href="https://yulun.me/2016/setup-tftp-server-on-ubuntu/" target="_blank" rel="noopener"><span>Install in Ubuntu</span></a></p><h3 id="Server-Step" data-id="Server-Step"><a class="anchor hidden-xs" href="#Server-Step" title="Server-Step"><span class="octicon octicon-link"></span></a><span>Server-Step</span></h3><p><span>1.先安裝好相關套件</span></p><pre><code>sudo apt install xinetd tftpd tftp
</code></pre><p><span>2.新增一組設定檔，放置於 /etc/xinetd.d/tftp</span></p><pre><code>service tftp
{
  protocol        = udp
  port            = 69
  socket_type     = dgram
  wait            = yes
  user            = nobody
  server          = /usr/sbin/in.tftpd
  server_args     = /tftpboot
  disable         = no
}
</code></pre><div class="alert alert-success">
<p><span>#-c: Allow new files to be created</span><br>
<span>#-s: Change  root  directory  on startup.</span><br>
<span>#-l:  Run the server in standalone (listen) mode, rather than run from inetd.</span></p>
</div><p><span>3.新增 /tftpboot 資料夾，並且修改權限</span></p><pre><code>sudo mkdir /tftpboot
sudo chmod -R 777 /tftpboot
sudo chown -R nobody /tftpboot
</code></pre><p><span>4.將 xinetd 重新啟動</span></p><pre><code>sudo service xinetd restart
</code></pre><h4 id="Problem" data-id="Problem"><a class="anchor hidden-xs" href="#Problem" title="Problem"><span class="octicon octicon-link"></span></a><span>Problem</span></h4><p><span>啟動 error 的話， 下面這個原因是缺少 /usr/sbin/in.tftpd 這個文件</span></p><p><img src="https://i.imgur.com/YAqV2cM.png" alt="" loading="lazy"></p><h3 id="Client" data-id="Client"><a class="anchor hidden-xs" href="#Client" title="Client"><span class="octicon octicon-link"></span></a><span>Client</span></h3><pre><code>tftp 172.168.1.200
tftp&gt; get test
</code></pre><p><img src="https://i.imgur.com/0r2hQJQ.png" alt="" loading="lazy"></p><hr><p><span>How to input variables in logger formatter? </span><a href="https://stackoverflow.com/questions/16203908/how-to-input-variables-in-logger-formatter" target="_blank" rel="noopener"><span>-Ref</span></a></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">import</span> logging

MYVAR = <span class="hljs-string">'gavin'</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextFilter</span>(logging.Filter):
    <span class="hljs-string">"""
    This is a filter which injects contextual information into the log.
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">filter</span>(<span class="hljs-params">self, record</span>):
        record.MYVAR = MYVAR
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

FORMAT = <span class="hljs-string">'%(MYVAR)s %(asctime)s - %(levelname)s - %(message)s'</span>
logging.basicConfig(<span class="hljs-built_in">format</span>=FORMAT, datefmt=<span class="hljs-string">'%d/%m/%Y %H:%M:%S'</span>)

logger = logging.getLogger(__name__)
logger.addFilter(ContextFilter())

logger.warning(<span class="hljs-string">"'Twas brillig, and the slithy toves"</span>)
</div></div></code></pre><h1 id="Logrotate" data-id="Logrotate"><a class="anchor hidden-xs" href="#Logrotate" title="Logrotate"><span class="octicon octicon-link"></span></a><span>Logrotate</span></h1><p><span>logrotate is designed to ease administration of systems that generate large numbers of log files. It allows automatic rotation, compression, removal, and mailing of log files. Each log file may be handled daily, weekly, monthly, or when it grows too large.</span></p><h2 id="原理" data-id="原理"><a class="anchor hidden-xs" href="#原理" title="原理"><span class="octicon octicon-link"></span></a><span>原理</span></h2><p><a href="https://wsgzao.github.io/post/logrotate/" target="_blank" rel="noopener"><span>inux 日誌切割神器logrotate 原理介紹和配置詳解</span></a></p><p><span>logrotate 是怎麼做到切換日誌時不影響程序正常的日誌輸出呢？</span><br>
<span>logrotate 提供了兩種解決方案。</span></p><ol>
<li>
<p><ins><span>create</span></ins><br>
<span>(a). 重命名正在輸出日誌文件，因為重命名只修改目錄以及文件的名稱，而進程操作文件使用的是inode，所以並不影響原程序繼續輸出日誌。</span><br>
<span>(b). 創建新的日誌文件，文件名和原日誌文件一樣，注意，此時只是文件名稱一樣，而inode 編號不同，原程序輸出的日誌還是往原日誌文件輸出。</span><br>
<span>(c). 最後通過某些方式通知程序，重新打開日誌文件；由於重新打開日誌文件會用到文件路徑而非inode 編號，所以打開的是新的日誌文件。</span></p>
</li>
<li>
<p><ins><span>copytruncate</span></ins><br>
<span>該方案是把正在輸出的日誌拷(copy) 一份出來，再清空(trucate) 原來的日誌；詳細步驟如下：</span></p>
</li>
</ol><p><span>(a).將當前正在輸出的日誌文件複製為目標文件，此時程序仍然將日誌輸出到原來文件中，此時，原文件名也沒有變。</span><br>
<span>(b).清空日誌文件，原程序仍然還是輸出到預案日誌文件中，因為清空文件只把文件的內容刪除了，而inode 並沒改變，後續日誌的輸出仍然寫入該文件中。</span></p><h3 id="Linux-文件操作機制" data-id="Linux-文件操作機制"><a class="anchor hidden-xs" href="#Linux-文件操作機制" title="Linux-文件操作機制"><span class="octicon octicon-link"></span></a><span>Linux 文件操作機制</span></h3><p><span>Linux 文件系統里文件和文件名的關係如下圖。</span><br>
<span>目錄也是文件，文件裡存著文件名和對應的inode 編號。</span><br>
<span>通過這個inode 編號可以查到文件的元數據和文件內容。</span><br>
<span>文件的元數據有引用計數、操作權限、擁有者ID、創建時間、最後修改時間等等。</span><br>
<img src="https://i.imgur.com/WndU6GI.png" alt="" loading="lazy"></p><p><span>文件件名並不在元數據里而是在目錄文件中。因此文件改名、移動，都不會修改文件，而是修改目錄文件</span><br>
<span>。</span></p><p><img src="https://i.imgur.com/8A9HP3k.png" alt="" loading="lazy"></p><h2 id="運行logrotate" data-id="運行logrotate"><a class="anchor hidden-xs" href="#運行logrotate" title="運行logrotate"><span class="octicon octicon-link"></span></a><span>運行logrotate</span></h2><p><span>具體logrotate 命令格式如下：</span></p><div class="alert alert-success">
<p><span>logrotate [OPTION…] &lt;configfile&gt;</span><br>
<span>-d, --debug ：debug 模式，測試配置文件是否有錯誤。</span><br>
<span>-f, --force ：強制轉儲文件。</span><br>
<span>-m, --mail=command ：壓縮日誌後，發送日誌到指定郵箱。</span><br>
<span>-s, --state=statefile ：使用指定的狀態文件。</span><br>
<span>-v, --verbose ：顯示轉儲過程。</span></p>
</div><h2 id="setting" data-id="setting"><a class="anchor hidden-xs" href="#setting" title="setting"><span class="octicon octicon-link"></span></a><span>setting</span></h2><hr><p><span>2022.1.12</span><br>
<a href="https://www.bilibili.com/video/BV1Lp411d7Zz/" target="_blank" rel="noopener"><span>云计算网络安全学习教程：Logrotate日志轮转</span><br>
</a></p><p><span>寫好的 atftp logrotate 規則放在 /etc/logrotate.d 這個資料夾下</span></p><pre><code>/var/log/atftp/atftpd.log {
    missingok #error is ok
    # monthly 
    size 30k
    daily
    rotate 3 #保留3份
    create 0777 root root
    su root root
}
</code></pre><p><span>強制執行一次 rotate </span><a href="https://blog.csdn.net/p15097962069/article/details/104014961" target="_blank" rel="noopener"><span>- ref</span></a></p><pre><code>sudo logrotate -vf /etc/logrotate.d/atftp
</code></pre><p><span>方法一:</span><br>
<span>一樣檔名設置，每次換檔案時，重啟 atftp server，這樣就會繼續 monitor設置檔名之檔案。</span><br>
<span>atftp server 重跑一次 setting， 所以繼續偵測同個檔名但不同 inode file.</span><br>
<span>原因: 因為logrotate 頻率不高</span></p><pre><code>logger = logging.getLogger()
logger.setLevel(logging.DEBUG)
handler = logging.handlers.SysLogHandler(address = '/dev/log')
handler.setFormatter(
    logging.Formatter("%(module)s-%(processName)s[%(process)d]: %(name)s: %(message)s")
    )
logger.addHandler(handler)
logger.debug('this is debug')
logger.critical('this is critical')
</code></pre><h2 id="syslog" data-id="syslog"><a class="anchor hidden-xs" href="#syslog" title="syslog"><span class="octicon octicon-link"></span></a><span>syslog</span></h2><p><span>syslog 是一個系統日誌記錄程序，但是由於它已經跟不上時代的腳步，所以rsyslog 替代了它，而且較新的 Ubuntu、Fedora 默認使用的都是 rsyslog。</span></p><p><span>rsyslog 有兩個配置文件，其一是/etc/rsyslog.conf，是主要的配置環境，另外一個是/etc/rsyslog.d/50-default.conf，主要是配置的 Filter Conditions。</span></p><ul>
<li><span>/etc/rsyslog.d/50-default.conf</span></li>
</ul><pre><code class="conf hljs"># 表示將所有facility的info級別,但不包括mail,authpriv,cron相關的信息,
記錄到 <span class="hljs-regexp">/var/</span>log/messages文件 
*.info;mail.none;authpriv.none;cron.none <span class="hljs-regexp">/var/</span>log/messages 

# 表示將權限,授權相關的所有基本的信息,記錄到<span class="hljs-regexp">/var/</span>log/secure文件中.
這個文件的權限是<span class="hljs-number">600</span> 
authpriv.* <span class="hljs-regexp">/var/</span>log/secure

# 表示將mail相關的所有基本的信息記錄到<span class="hljs-regexp">/var/</span>log/maillog文件中,
可以看到路徑前面有一個 <span class="hljs-string">"-"</span> 而 <span class="hljs-string">"-"</span> 表示異步寫入磁碟
mail.* -<span class="hljs-regexp">/var/</span>log/maillog 

# 表示將任務計劃相關的所有級別的信息記錄到<span class="hljs-regexp">/var/</span>log/cron文件中
cron.* <span class="hljs-regexp">/var/</span>log/cron 

# 表示將所有facility的emerg級別的信息,發送給登錄到系統上的所有用戶
*.emerg * 

# 表示將uucp及news的crit級別的信息記錄到<span class="hljs-regexp">/var/</span>log/spooler文件中
uucp,news.crit <span class="hljs-regexp">/var/</span>log/spooler

# 表示將local7的所有級別的信息記錄到<span class="hljs-regexp">/var/</span>log/boot.log文件中上面說過
local0 到local7這<span class="hljs-number">8</span>個是用戶自定義使用的,這裡的local7記錄的是系統啟動相關的信息
local7.* <span class="hljs-regexp">/var/</span>log/boot.log
</code></pre><h3 id="分類" data-id="分類"><a class="anchor hidden-xs" href="#分類" title="分類"><span class="octicon octicon-link"></span></a><span>分類</span></h3><p><a href="https://linux.vbird.org/linux_basic/centos7/0570syslog.php" target="_blank" rel="noopener"><span>Ref:</span></a><span> rsyslogd 主要還是透過 Linux 核心提供的 syslog 相關規範來設定資料的分類的，Linux 的 syslog 本身有規範一些服務訊息， 你可以透過這些服務來儲存系統的訊息。</span></p><p><span>Linux 核心的 syslog 認識的服務類型主要有底下這些:</span></p><table>
<thead>
<tr>
<th><span>相對序號</span></th>
<th><span>服務類別</span></th>
<th><span>服務類別</span></th>
</tr>
</thead>
<tbody>
<tr>
<td><span>0</span></td>
<td><span>kern(kernel)</span></td>
<td><span>就是核心 (kernel) 產生的訊息，大部分都是硬體偵測以及核心功能的啟用</span></td>
</tr>
<tr>
<td><span>1</span></td>
<td><span>user</span></td>
<td><span>在使用者層級所產生的資訊，例如後續會介紹到的用戶使用 logger 指令來記錄登錄檔的功能</span></td>
</tr>
<tr>
<td><span>2</span></td>
<td><span>mail</span></td>
<td><span>只要與郵件收發有關的訊息記錄都屬於這個</span></td>
</tr>
<tr>
<td><span>3</span></td>
<td><span>daemon</span></td>
<td><span>主要是系統的服務所產生的資訊，例如 systemd 就是這個有關的訊息</span></td>
</tr>
<tr>
<td><span>4</span></td>
<td><span>auth</span></td>
<td><span>主要與認證/授權有關的機制，例如 login, ssh, su 等需要帳號/密碼</span></td>
</tr>
<tr>
<td><span>5</span></td>
<td><span>syslog</span></td>
<td><span>就是由 syslog 相關協定產生的資訊，其實就是 rsyslogd 這支程式本身產生的資訊！</span></td>
</tr>
<tr>
<td><span>9</span></td>
<td><span>cron</span></td>
<td><span>就是例行性工作排程 cron/at 等產生訊息記錄的地方；</span></td>
</tr>
<tr>
<td><span>11</span></td>
<td><span>ftp</span></td>
<td><span>與 FTP 通訊協定有關的訊息輸出！</span></td>
</tr>
<tr>
<td><span>16~23</span></td>
<td><span>local0 ~ local7</span></td>
<td><span>保留給本機用戶使用的一些登錄檔訊息，較常與終端機互動。</span></td>
</tr>
</tbody>
</table><p><span>上面談到的都是 Linux 核心的 syslog 函數自行制訂的服務名稱，軟體開發商可以透過呼叫上述的服務名稱來記錄他們的軟體。</span></p><ul>
<li><span>舉例來說， sendmail 與 postfix 及 dovecot 都是與郵件有關的軟體，這些軟體在設計登錄檔記錄時，都會主動呼叫 syslog 內的 mail 服務名稱 (LOG_MAIL)。所以上述三個軟體 (sendmail, postfix, dovecot) 產生的訊息在 syslog 看起來，就會『是 mail 』類型的服務了</span></li>
</ul><p><img src="https://i.imgur.com/zDQJY0n.png" alt="" loading="lazy"></p><h3 id="fliter-setting" data-id="fliter-setting"><a class="anchor hidden-xs" href="#fliter-setting" title="fliter-setting"><span class="octicon octicon-link"></span></a><span>fliter setting</span></h3><p><a href="https://serverfault.com/questions/15106/is-there-a-way-to-filter-syslog-entries" target="_blank" rel="noopener"><span>Is there a way to filter syslog entries?</span></a></p><pre><code>:rawmsg,contains,"atftpd" -/var/log/atftp/sys-atftp.log
</code></pre></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                
                
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
